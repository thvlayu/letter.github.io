<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Computer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.49.4/dist/umd/supabase.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollSmoother.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
</head>

<body>
    <div id="smooth-wrapper">
        <div id="smooth-content">
            <div id="main-view-wrapper"> <!-- NEW WRAPPER -->
                <div id="macintosh-container">
                    <div id="question-marks-container">
                        <span class="question-mark" id="q-mark-1">?</span>
                        <span class="question-mark" id="q-mark-2">?</span>
                        <span class="question-mark" id="q-mark-3">?</span>
                    </div>
                    <img src="Assets/Apple-Front.jpeg" alt="Macintosh Classic" id="macintosh-image">
                </div>
            </div>
        </div>
    </div>

    <!-- CRT Effect Elements -->
    <div class="screen-container">
        <div class="screen-content">
            <div id="desktop-ui">
                <div id="top-menu-bar">
                    <div class="menu-section left">
                        <div id="heart-logo">
                            <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="heart-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" class="gradient-start" stop-color="#FF0000" />
                                        <stop offset="100%" class="gradient-end" stop-color="#FFFF00" />
                                    </linearGradient>
                                </defs>
                                <path fill="url(#heart-gradient)"
                                    d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                            </svg>
                        </div>
                        <ul id="static-menu">
                            <li id="system-settings-entry" style="cursor: pointer;"><b>System Setting</b></li>
                            <li>File</li>
                            <li>Window</li>
                            <li>Help</li>
                        </ul>
                    </div>
                    <div id="minimized-apps-container"></div>
                    <div class="menu-section right">
                        <button id="crt-toggle" title="Toggle CRT Effect">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0"></path>
                                <path d="M21 12c-2.2 4-5.2 6-9 6s-6.8-2-9-6c2.2-4 5.2-6 9-6s6.8 2 9 6"></path>
                            </svg>
                        </button>
                        <div id="date-time"></div>
                    </div>
                </div>
                <div id="desktop-icons-container">
                    <div class="desktop-icon" id="letter-icon" data-target="letter-window">
                        <div class="icon-graphic">‚úâÔ∏è</div>
                        <span>Letter</span>
                    </div>
                    <div class="desktop-icon" id="computer-icon" data-target="computer-window">
                        <div class="icon-graphic">üíª</div>
                        <span>My Computer</span>
                    </div>
                    <div class="desktop-icon" id="music-icon" data-target="music-window">
                        <div class="icon-graphic">üéµ</div>
                        <span>Music</span>
                    </div>
                    <div class="desktop-icon" id="terminal-icon" data-target="terminal-window">
                        <div class="icon-graphic">‚ùØ_</div>
                        <span>Terminal</span>
                    </div>
                    <div class="desktop-icon" id="chiptune-icon" data-target="chiptune-window">
                        <div class="icon-graphic">üéπ</div>
                        <span>Chiptune</span>
                    </div>
                </div>
            </div>
            <div id="icon-context-menu" class="context-menu">
                <ul>
                    <li data-action="open">Open</li>
                    <li class="separator"></li>
                    <li data-action="create-shortcut">Create Shortcut</li>
                    <li data-action="pin">Pin to Taskbar</li>
                    <li class="separator"></li>
                    <li data-action="properties">Properties</li>
                </ul>
            </div>
            <div id="desktop-context-menu" class="context-menu">
                <ul>
                    <li data-action="change-background">Change Background...</li>
                </ul>
            </div>
            <div id="letter-window" class="window">
                <div class="title-bar">
                    <span class="title">Letter</span>
                    <div class="window-controls">
                        <button class="minimize-btn">-</button>
                        <button class="fullscreen-btn">‚ñ°</button>
                        <button class="close-btn">x</button>
                    </div>
                </div>
                <div class="window-content letter-content">
                    <div class="letter-sidebar">
                        <input type="text" class="letter-search" placeholder="Search...">
                        <div class="letter-history">
                            <!-- Mock letter list items -->
                            
                        </div>
                    </div>
                    <div class="letter-composer">
                        <div class="composer-header">
                            <input type="text" class="recipient-input" placeholder="To:">
                            <button id="user-account-btn" class="composer-icon-btn" title="Account">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </button>
                        </div>
                        <textarea class="letter-editor" placeholder="Dear..."></textarea>
                        <div class="composer-footer">
                            <div class="composer-actions-left">
                            <div class="custom-dropdown" id="letter-type-dropdown">
                                <button class="dropdown-toggle">
                                    <span>Normal Letter</span>
                                    <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="18 15 12 9 6 15"></polyline>
                                    </svg>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item" data-value="normal">Normal Letter</div>
                                    <div class="dropdown-item" data-value="secret">Secret Letter</div>
                                </div>
                            </div>
                            </div>
                            <div class="composer-actions-right">
                            <button id="copy-link-btn" title="Copy link" style="display: none;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                            </button>
                                <button id="send-letter-btn" class="send-btn"><span class="send-text">Send</span><span class="send-icon">‚úî</span></button>
                            </div>
                        </div>
                        <div id="user-account-popup" class="account-popup">
                            <h4 id="account-popup-title">Account</h4>
                            <div id="account-popup-body">
                                <p>You are not logged in.</p>
                                <div class="account-popup-actions">
                                    <button id="popup-login-btn" class="account-action-btn">Log In</button>
                                    <button id="popup-signup-btn" class="account-action-btn primary">Sign Up</button>
                                </div>
                            </div>
                            <div id="account-popup-user-view" style="display: none;">
                                <p>Welcome, <span id="account-username"></span>!</p>
                                <button id="popup-logout-btn" class="account-action-btn">Log Out</button>
                            </div>
                            <button class="close-popup-btn">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="computer-window" class="window">
                <div class="title-bar">
                    <span class="title">My Computer</span>
                    <div class="window-controls">
                        <button class="minimize-btn">-</button>
                        <button class="fullscreen-btn">‚ñ°</button>
                        <button class="close-btn">X</button>
                    </div>
                </div>
                <div class="window-content">
                    <h3>System Information</h3>
                    <ul>
                        <li><b>User:</b> Guest (Not Logged In)</li>
                        <li><b>System:</b> Web-OS 1.0</li>
                        <li><b>Session Time:</b> <span id="session-time">0s</span></li>
                    </ul>
                    <button id="log-off-btn">Log OFF</button>
                </div>
            </div>
            <div id="music-window" class="window">
                <div class="title-bar">
                    <span class="title">Music Player</span>
                    <div class="window-controls">
                        <button class="minimize-btn">-</button>
                        <button class="fullscreen-btn">‚ñ°</button>
                        <button class="close-btn">X</button>
                    </div>
                </div>
                <div class="window-content music-player-content">
                    <div class="music-sidebar">
                        <div class="sidebar-header">
                            <h3>Queue</h3>
                        </div>
                        <ul class="music-queue-list">
                            <!-- Queue items will be generated by JS -->
                        </ul>
                        <div class="sidebar-footer">
                            <button class="settings-btn">‚öôÔ∏è Settings</button>
                        </div>
                    </div>
                    <div class="music-main-view">
                        <button class="hamburger-menu">‚ò∞</button>
                        <button class="add-music-btn">+</button>
                        <div class="album-art"></div>
                        <div class="track-info">
                            <div class="track-title">No Song Playing</div>
                            <div class="track-artist">...</div>
                        </div>
                        <div class="player-controls">
                            <button id="prev-track-btn">‚èÆ</button>
                            <button id="play-pause-btn">‚ñ∂Ô∏è</button>
                            <button id="next-track-btn">‚è≠</button>
                        </div>
                        <div class="progress-bar-container">
                            <input type="range" id="seek-slider" class="seek-slider" max="100" value="0">
                        </div>
                        <div class="time-display">
                            <span id="current-time">0:00</span> / <span id="total-duration">0:00</span>
                        </div>
                    </div>
                    <div class="music-settings-view" style="display: none;">
                        <h3>Settings</h3>
                        <p>Settings content will go here.</p>
                        <button class="back-to-player-btn">Back</button>
                    </div>
                </div>
            </div>
            <div id="terminal-window" class="window">
                <div class="title-bar">
                    <span class="title">Terminal</span>
                    <div class="window-controls">
                        <button class="minimize-btn">-</button>
                        <button class="fullscreen-btn">‚ñ°</button>
                        <button class="close-btn">X</button>
                    </div>
                </div>
                <div class="window-content terminal-content" id="terminal-content">
                    <!-- All terminal content, including input, will be generated by JS -->
                </div>
            </div>
            <div id="system-settings-window" class="window">
                <div class="title-bar">
                    <span class="title">System Settings</span>
                    <div class="window-controls">
                        <button class="minimize-btn">-</button>
                        <button class="fullscreen-btn">‚ñ°</button>
                        <button class="close-btn">X</button>
                    </div>
                </div>
                <div class="window-content settings-content">
                    <div class="settings-tabs">
                        <button class="tab-btn active" data-tab="appearance">Appearance</button>
                        <button class="tab-btn" data-tab="about">About</button>
                    </div>

                    <div class="settings-tab-content active" id="tab-appearance">
                        <h4>Change Background</h4>
                        <p>Upload your own image to use as a desktop background.</p>
                        <button id="change-bg-btn" class="settings-action-btn">Upload Image...</button>
                        <hr>
                        <h4>Default Wallpapers</h4>
                        <p>Or select from one of the built-in wallpapers.</p>
                        <div id="wallpaper-selection">
                            <div class="wallpaper-thumb" data-bg="url('Assets/wallpaper/pexels-media-5199173.jpeg')"
                                style="background-image: url('Assets/wallpaper/pexels-media-5199173.jpeg')"></div>
                            <div class="wallpaper-thumb" data-bg="url('Assets/wallpaper/pexels-media-5286712.jpeg')"
                                style="background-image: url('Assets/wallpaper/pexels-media-5286712.jpeg')"></div>
                            <div class="wallpaper-thumb" data-bg="url('Assets/wallpaper/clouds.jpeg')"
                                style="background-image: url('Assets/wallpaper/clouds.jpeg')"></div>
                            <div class="wallpaper-thumb" data-bg="url('Assets/wallpaper/Clouds2.jpeg')"
                                style="background-image: url('Assets/wallpaper/Clouds2.jpeg')"></div>
                            <div class="wallpaper-thumb" data-bg="#005f5f" style="background-color: #005f5f;"></div>
                            <div class="wallpaper-thumb" data-bg="#51080d" style="background-color: #51080d;"></div>
                            <div class="wallpaper-thumb" data-bg="#0D1433" style="background-color: #0D1433;"></div>
                            <div class="wallpaper-thumb" data-bg="#222222" style="background-color: #222222;"></div>
                        </div>
                    </div>

                    <div class="settings-tab-content" id="tab-about">
                        <h4>About This Project</h4>
                        <p>This is a Web OS passion project.</p>
                        <p>A nostalgic journey into the interfaces of the past, reimagined for the web. Built with HTML,
                            CSS, and vanilla JavaScript, with a little help from GSAP for animations.</p>
                        <p>The goal is to create a fun, interactive, and customizable desktop experience right in your
                            browser.</p>
                    </div>
                </div>
            </div>
            <div id="chiptune-window" class="window">
                <div class="title-bar">
                    <span class="title">Chiptune Composer</span>
                    <div class="window-controls">
                        <button class="minimize-btn">-</button>
                        <button class="fullscreen-btn">‚ñ°</button>
                        <button class="close-btn">X</button>
                    </div>
                </div>
                <div class="window-content chiptune-content">
                    <div id="sequencer-grid"></div>
                    <div id="chiptune-controls">
                        <button id="chiptune-play-btn">Play</button>
                        <button id="chiptune-stop-btn">Stop</button>
                        <div class="control-group">
                            <label for="tempo-slider">Tempo</label>
                            <input type="range" id="tempo-slider" min="60" max="240" value="120">
                            <span id="tempo-display">120</span>
                        </div>
                        <button id="chiptune-clear-btn">Clear</button>
                    </div>
                </div>
            </div>
            <div class="crt-overlay"></div>
            <div class="crt-lines"></div>
        </div>
    </div>

    <!-- Auth Modals -->
    <div id="auth-modal-container" class="modal-container" style="display: none;">
        <div class="modal-content auth-modal-content">
            <button class="modal-close-btn">√ó</button>
            <h3 id="auth-title">Sign In</h3>
            <div class="auth-icon">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="auth-icon-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#A020F0" />
                            <stop offset="100%" stop-color="#4169E1" />
                        </linearGradient>
                    </defs>
                    <path d="M12 2L9.46 9.46L2 12L9.46 14.54L12 22L14.54 14.54L22 12L14.54 9.46L12 2Z" stroke="url(#auth-icon-gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <form id="auth-form">
                <input type="email" id="auth-email" placeholder="Email" required autocomplete="email">
                <input type="password" id="auth-password" placeholder="Password" required autocomplete="current-password">
                <button type="submit" id="auth-submit-btn">Sign In</button>
            </form>
            <p id="auth-toggle-text">Don't have an account? <a href="#" id="auth-toggle-link">Sign Up</a></p>
            <p id="auth-error" class="error-message" style="display: none;"></p>
        </div>
    </div>

    <div id="username-modal-container" class="modal-container" style="display: none;">
        <div class="modal-content">
            <button class="modal-close-btn">√ó</button>
            <h3>Choose your username</h3>
            <p>This will be your unique name on the platform.</p>
            <form id="username-form">
                <input type="text" id="username-input" placeholder="Username" required minlength="3" maxlength="15" pattern="^[a-zA-Z0-9_]+$">
                <button type="submit" id="username-submit-btn">Save Username</button>
            </form>
            <p id="username-error" class="error-message" style="display: none;"></p>
        </div>
    </div>

    <div id="otp-modal-container" class="modal-container" style="display: none;">
        <div class="modal-content">
            <button class="modal-close-btn">√ó</button>
            <h3>Check your email</h3>
            <p>We've sent a confirmation link to your email address. Please click the link to complete your registration.</p>
        </div>
    </div>

    <audio id="audio-player" style="display: none;"></audio>
    <script src="script.js"></script>
    <input type="file" id="background-image-input" accept="image/*" style="display: none;" />
    <input type="file" id="music-file-input" accept="audio/mp3" multiple style="display: none;" />
</body>

</html>